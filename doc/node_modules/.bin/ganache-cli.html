<!DOCTYPE html>
<html>
<head>
  <title>ganache-cli</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/.bin/ganache-cli";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>ganache-cli</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>make sourcemaps work!</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-built_in">require</span>(<span class="hljs-string">'source-map-support'</span>).install();

<span class="hljs-keyword">var</span> yargs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"yargs"</span>);
<span class="hljs-keyword">var</span> pkg = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./package.json"</span>);
<span class="hljs-keyword">var</span> {toChecksumAddress, BN} = <span class="hljs-built_in">require</span>(<span class="hljs-string">"ethereumjs-util"</span>);
<span class="hljs-keyword">var</span> ganache;
<span class="hljs-keyword">try</span> {
  ganache = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./lib"</span>);
} <span class="hljs-keyword">catch</span>(e) {
  ganache = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./build/ganache-core.node.cli.js"</span>);
}
<span class="hljs-keyword">var</span> to = ganache.to;
<span class="hljs-keyword">var</span> initArgs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./args"</span>)

<span class="hljs-keyword">var</span> detailedVersion = <span class="hljs-string">"Ganache CLI v"</span> + pkg.version + <span class="hljs-string">" (ganache-core: "</span> + ganache.version + <span class="hljs-string">")"</span>;

<span class="hljs-keyword">var</span> isDocker = <span class="hljs-string">"DOCKER"</span> <span class="hljs-keyword">in</span> process.env &amp;&amp; process.env.DOCKER.toLowerCase() === <span class="hljs-string">"true"</span>;
<span class="hljs-keyword">var</span> argv = initArgs(yargs, detailedVersion, isDocker).argv;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseAccounts</span>(<span class="hljs-params">accounts</span>) </span>{
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">splitAccount</span>(<span class="hljs-params">account</span>) </span>{
    account = account.split(<span class="hljs-string">','</span>)
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">secretKey</span>: account[<span class="hljs-number">0</span>],
      <span class="hljs-attr">balance</span>: account[<span class="hljs-number">1</span>]
    };
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> accounts === <span class="hljs-string">'string'</span>)
    <span class="hljs-keyword">return</span> [ splitAccount(accounts) ];
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.isArray(accounts))
    <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">var</span> ret = []
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; accounts.length; i++) {
    ret.push(splitAccount(accounts[i]));
  }
  <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-keyword">if</span> (argv.d) {
  argv.s = <span class="hljs-string">"TestRPC is awesome!"</span>; <span class="hljs-comment">// Seed phrase; don't change to Ganache, maintain original determinism</span>
}

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> argv.unlock == <span class="hljs-string">"string"</span>) {
  argv.unlock = [argv.unlock];
}

<span class="hljs-keyword">var</span> logger = <span class="hljs-built_in">console</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>If quiet argument passed, no output</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">if</span> (argv.q === <span class="hljs-literal">true</span>){
  logger = {
    <span class="hljs-attr">log</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{}
  };
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>If the mem argument is passed, only show memory output,
not transaction history.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">if</span> (argv.mem === <span class="hljs-literal">true</span>) {
  logger = {
    <span class="hljs-attr">log</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{}
  };

  setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log(process.memoryUsage());
  }, <span class="hljs-number">1000</span>);
}

<span class="hljs-keyword">var</span> options = {
  <span class="hljs-attr">port</span>: argv.p,
  <span class="hljs-attr">hostname</span>: argv.h,
  <span class="hljs-attr">debug</span>: argv.debug,
  <span class="hljs-attr">seed</span>: argv.s,
  <span class="hljs-attr">mnemonic</span>: argv.m,
  <span class="hljs-attr">total_accounts</span>: argv.a,
  <span class="hljs-attr">default_balance_ether</span>: argv.e,
  <span class="hljs-attr">blockTime</span>: argv.b,
  <span class="hljs-attr">gasPrice</span>: argv.g,
  <span class="hljs-attr">gasLimit</span>: argv.l,
  <span class="hljs-attr">callGasLimit</span>: argv.callGasLimit,
  <span class="hljs-attr">accounts</span>: parseAccounts(argv.account),
  <span class="hljs-attr">unlocked_accounts</span>: argv.unlock,
  <span class="hljs-attr">fork</span>: argv.f,
  <span class="hljs-attr">forkCacheSize</span>: argv.forkCacheSize,
  <span class="hljs-attr">hardfork</span>: argv.k,
  <span class="hljs-attr">network_id</span>: argv.i,
  <span class="hljs-attr">verbose</span>: argv.v,
  <span class="hljs-attr">secure</span>: argv.n,
  <span class="hljs-attr">db_path</span>: argv.db,
  <span class="hljs-attr">hd_path</span>: argv.hdPath,
  <span class="hljs-attr">account_keys_path</span>: argv.account_keys_path,
  <span class="hljs-attr">vmErrorsOnRPCResponse</span>: !argv.noVMErrorsOnRPCResponse,
  <span class="hljs-attr">logger</span>: logger,
  <span class="hljs-attr">allowUnlimitedContractSize</span>: argv.allowUnlimitedContractSize,
  <span class="hljs-attr">time</span>: argv.t,
  <span class="hljs-attr">keepAliveTimeout</span>: argv.keepAliveTimeout,
  <span class="hljs-attr">_chainId</span>: argv.chainId,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>gross!</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  _chainIdRpc: argv.chainId
}

<span class="hljs-keyword">var</span> server = ganache.server(options);

<span class="hljs-built_in">console</span>.log(detailedVersion);

<span class="hljs-keyword">let</span> started = <span class="hljs-literal">false</span>;
process.on(<span class="hljs-string">"uncaughtException"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
  <span class="hljs-keyword">if</span> (started) {
    <span class="hljs-built_in">console</span>.log(e);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">console</span>.log(e.stack);
  }
  process.exit(<span class="hljs-number">1</span>);
})

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>See http://stackoverflow.com/questions/10021373/what-is-the-windows-equivalent-of-process-onsigint-in-node-js</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">if</span> (process.platform === <span class="hljs-string">"win32"</span>) {
  <span class="hljs-built_in">require</span>(<span class="hljs-string">"readline"</span>).createInterface({
    <span class="hljs-attr">input</span>: process.stdin,
    <span class="hljs-attr">output</span>: process.stdout
  })
  .on(<span class="hljs-string">"SIGINT"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    process.emit(<span class="hljs-string">"SIGINT"</span>);
  });
}

<span class="hljs-keyword">const</span> closeHandler = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>graceful shutdown</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  server.close(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
    <span class="hljs-keyword">if</span> (err) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>https://nodejs.org/api/process.html#process_process_exit_code
writes to process.stdout in Node.js are sometimes asynchronous and may occur over
multiple ticks of the Node.js event loop. Calling process.exit(), however, forces
the process to exit before those additional writes to stdout can be performed.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span>(process.stdout._handle) process.stdout._handle.setBlocking(<span class="hljs-literal">true</span>);
      <span class="hljs-built_in">console</span>.log(err.stack || err);
      process.exit();
    } <span class="hljs-keyword">else</span> {
      process.exit(<span class="hljs-number">0</span>);
    }
  });
}

process.on(<span class="hljs-string">"SIGINT"</span>, closeHandler);
process.on(<span class="hljs-string">"SIGTERM"</span>, closeHandler);
process.on(<span class="hljs-string">"SIGHUP"</span>, closeHandler);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">startGanache</span>(<span class="hljs-params">err, result</span>) </span>{
  <span class="hljs-keyword">if</span> (err) {
    <span class="hljs-built_in">console</span>.log(err);
    <span class="hljs-keyword">return</span>;
  }
  started = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">var</span> state = result ? result : server.provider.manager.state;

  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">""</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Available Accounts"</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"=================="</span>);

  <span class="hljs-keyword">var</span> accounts = state.accounts;
  <span class="hljs-keyword">var</span> addresses = <span class="hljs-built_in">Object</span>.keys(accounts);
  <span class="hljs-keyword">var</span> ethInWei = <span class="hljs-keyword">new</span> BN(<span class="hljs-string">"1000000000000000000"</span>);

  addresses.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">address, index</span>) </span>{
    <span class="hljs-keyword">var</span> balance = <span class="hljs-keyword">new</span> BN(accounts[address].account.balance);
    <span class="hljs-keyword">var</span> strBalance = balance.divRound(ethInWei).toString();
    <span class="hljs-keyword">var</span> about = balance.mod(ethInWei).isZero() ? <span class="hljs-string">""</span> : <span class="hljs-string">"~"</span>;
    <span class="hljs-keyword">var</span> line = <span class="hljs-string">`(<span class="hljs-subst">${index}</span>) <span class="hljs-subst">${toChecksumAddress(address)}</span> (<span class="hljs-subst">${about}</span><span class="hljs-subst">${strBalance}</span> ETH)`</span>;

    <span class="hljs-keyword">if</span> (state.isUnlocked(address) == <span class="hljs-literal">false</span>) {
      line += <span class="hljs-string">" 🔒"</span>;
    }

    <span class="hljs-built_in">console</span>.log(line);
  });

  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">""</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Private Keys"</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"=================="</span>);

  addresses.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">address, index</span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"("</span> + index + <span class="hljs-string">") "</span> + <span class="hljs-string">"0x"</span> + accounts[address].secretKey.toString(<span class="hljs-string">"hex"</span>));
  });


  <span class="hljs-keyword">if</span> (options.account_keys_path != <span class="hljs-literal">null</span>) {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">""</span>);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Accounts and keys saved to "</span> + options.account_keys_path);
  }

  <span class="hljs-keyword">if</span> (options.accounts == <span class="hljs-literal">null</span>) {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">""</span>);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"HD Wallet"</span>);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"=================="</span>);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Mnemonic:      "</span> + state.mnemonic);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Base HD Path:  "</span> + state.wallet_hdpath + <span class="hljs-string">"{account_index}"</span>)
  }

  <span class="hljs-keyword">if</span> (options.gasPrice) {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">""</span>);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Gas Price"</span>);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"=================="</span>);
    <span class="hljs-built_in">console</span>.log(options.gasPrice);
  }

  <span class="hljs-keyword">if</span> (options.gasLimit) {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">""</span>);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Gas Limit"</span>);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"=================="</span>);
    <span class="hljs-built_in">console</span>.log(options.gasLimit);
  }

  <span class="hljs-keyword">if</span> (options.callGasLimit) {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">""</span>);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Call Gas Limit"</span>);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"=================="</span>);
    <span class="hljs-built_in">console</span>.log(options.callGasLimit);
  }

  <span class="hljs-keyword">if</span> (options.fork) {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">""</span>);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Forked Chain"</span>);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"=================="</span>);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Location:       "</span> + state.blockchain.options.fork);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Block:          "</span> + to.number(state.blockchain.forkBlockNumber));
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Network ID:     "</span> + state.net_version);
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Time:           "</span> + (state.blockchain.startTime || <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).toString());
    <span class="hljs-keyword">let</span> maxCacheSize;
    <span class="hljs-keyword">if</span> (options.forkCacheSize === <span class="hljs-number">-1</span>) {
      maxCacheSize = <span class="hljs-string">"∞"</span>;
    } <span class="hljs-keyword">else</span> {
      maxCacheSize = options.forkCacheSize + <span class="hljs-string">" bytes"</span>;
    }
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Max Cache Size: "</span> + maxCacheSize);
  }

  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">""</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Listening on "</span> + options.hostname + <span class="hljs-string">":"</span> + options.port);
}

server.listen(options.port, options.hostname, startGanache);

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
