<!DOCTYPE html>
<html>
<head>
  <title>UPGRADING.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/abstract-leveldown/UPGRADING.md";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#upgrade-guide">Upgrade Guide</a>
      </div>

      <div class="heading h2">
        <a href="#table-of-contents">Table of Contents</a>
      </div>

      <div class="heading h2">
        <a href="#v6">v6</a>
      </div>

      <div class="heading h3">
        <a href="#changes-to-public-api">Changes to public API</a>
      </div>

      <div class="heading h4">
        <a href="#nullish-values-are-rejected">Nullish values are rejected</a>
      </div>

      <div class="heading h4">
        <a href="#range-options-are-serialized">Range options are serialized</a>
      </div>

      <div class="heading h4">
        <a href="#the-rules-for-range-options-have-been-relaxed">The rules for range options have been relaxed</a>
      </div>

      <div class="heading h4">
        <a href="#zero-length-array-keys-are-rejected">Zero-length array keys are rejected</a>
      </div>

      <div class="heading h4">
        <a href="#no-longer-assumes-support-of-boolean-and-nan-keys">No longer assumes support of boolean and NaN keys</a>
      </div>

      <div class="heading h4">
        <a href="#browser-support">Browser support</a>
      </div>

      <div class="heading h3">
        <a href="#changes-to-private-api">Changes to private API</a>
      </div>

      <div class="heading h4">
        <a href="#location-was-removed">location was removed</a>
      </div>

      <div class="heading h4">
        <a href="#abstract-test-suite-has-moved-to-a-single-entry-point">Abstract test suite has moved to a single entry point</a>
      </div>

      <div class="heading h4">
        <a href="#the-collectentries-utility-has-moved">The collectEntries utility has moved</a>
      </div>

      <div class="heading h4">
        <a href="#setup-and-teardown-became-noops">Setup and teardown became noops</a>
      </div>

      <div class="heading h4">
        <a href="#optional-tests-have-been-separated">Optional tests have been separated</a>
      </div>

      <div class="heading h4">
        <a href="#iterator-must-have-a-db-reference">Iterator must have a db reference</a>
      </div>

      <div class="heading h4">
        <a href="#seeking-became-part-of-official-api">Seeking became part of official API</a>
      </div>

      <div class="heading h4">
        <a href="#chained-batch-has-been-refactored">Chained batch has been refactored</a>
      </div>

      <div class="heading h4">
        <a href="#default-_serializekey-and-_serializevalue-became-identity-functions">Default _serializeKey and _serializeValue became identity functions</a>
      </div>

      <div class="heading h2">
        <a href="#v5">v5</a>
      </div>

      <div class="heading h2">
        <a href="#v4">v4</a>
      </div>

      <div class="heading h4">
        <a href="#default-testcommon-parameter">default testCommon parameter</a>
      </div>

      <div class="heading h4">
        <a href="#testbuffer-parameter-removed">testBuffer parameter removed</a>
      </div>

      <div class="heading h4">
        <a href="#.approximatesize-method-removed">.approximateSize method removed</a>
      </div>

      <div class="heading h4">
        <a href="#._isbuffer-method-removed">._isBuffer method removed</a>
      </div>

      <div class="heading h4">
        <a href="#isleveldown-function-removed">isLevelDOWN function removed</a>
      </div>

      <div class="heading h4">
        <a href="#ranges-test.js-renamed">ranges-test.js renamed</a>
      </div>

      <div class="heading h2">
        <a href="#v3">v3</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="upgrade-guide">
  <h1>
    <a href="#upgrade-guide" name="upgrade-guide" class="pilcrow"></a>
Upgrade Guide
  </h1>
</div>
<p>This document describes breaking changes and how to upgrade. For a complete list of changes including minor and patch releases, please refer to the <a href="CHANGELOG.md.html">changelog</a>.</p>
<div class="pilwrap" id="table-of-contents">
  <h2>
    <a href="#table-of-contents" name="table-of-contents" class="pilcrow"></a>
Table of Contents
  </h2>
</div>
<details><summary>Click to expand</summary>
<ul>
<li><a href="#v6.html">v6</a></li>
<li><a href="#v5.html">v5</a></li>
<li><a href="#v4.html">v4</a></li>
<li><a href="#v3.html">v3</a></li>
</ul>
</details>
<div class="pilwrap" id="v6">
  <h2>
    <a href="#v6" name="v6" class="pilcrow"></a>
v6
  </h2>
</div>
<p>This release brings a major refactoring of the test suite, decouples <code>abstract-leveldown</code> from disk-based implementations and solves long-standing issues around serialization and type support. Because the changes are substantial, this guide has two sections:</p>
<ol>
<li><strong>Changes to public API</strong> - for consumers of any implementation.</li>
<li><strong>Changes to private API</strong> - intended for implementors.</li>
</ol>
<div class="pilwrap" id="changes-to-public-api">
  <h3>
    <a href="#changes-to-public-api" name="changes-to-public-api" class="pilcrow"></a>
Changes to public API
  </h3>
</div>
<div class="pilwrap" id="nullish-values-are-rejected">
  <h4>
    <a href="#nullish-values-are-rejected" name="nullish-values-are-rejected" class="pilcrow"></a>
Nullish values are rejected
  </h4>
</div>
<p>In addition to rejecting <code>null</code> and <code>undefined</code> as <em>keys</em>, <code>abstract-leveldown</code> now also rejects these types as <em>values</em>, due to preexisting significance in streams and iterators.</p>
<p>Before this, the behavior of these types depended on a large number of factors: <code>_serializeValue</code> and type support of the underlying storage, whether <code>get()</code>, <code>iterator()</code> or a stream was used to retrieve values, the <code>keys</code> and <code>asBuffer</code> options of <code>iterator()</code> and finally, which encoding was selected.</p>
<div class="pilwrap" id="range-options-are-serialized">
  <h4>
    <a href="#range-options-are-serialized" name="range-options-are-serialized" class="pilcrow"></a>
Range options are serialized
  </h4>
</div>
<p>Previously, range options like <code>lt</code> were passed through as-is, unlike keys.</p>
<div class="pilwrap" id="the-rules-for-range-options-have-been-relaxed">
  <h4>
    <a href="#the-rules-for-range-options-have-been-relaxed" name="the-rules-for-range-options-have-been-relaxed" class="pilcrow"></a>
The rules for range options have been relaxed
  </h4>
</div>
<p>Because <code>null</code>, <code>undefined</code>, zero-length strings and zero-length buffers are significant types in encodings like <code>bytewise</code> and <code>charwise</code>, they became valid as range options. In fact, any type is now valid. This means <code>db.iterator({ gt: undefined })</code> is not the same as <code>db.iterator({})</code>.</p>
<p>Furthermore, <code>abstract-leveldown</code> makes no assumptions about the meaning of these types. Range tests that assumed <code>null</code> meant &quot;not defined&quot; have been removed.</p>
<div class="pilwrap" id="zero-length-array-keys-are-rejected">
  <h4>
    <a href="#zero-length-array-keys-are-rejected" name="zero-length-array-keys-are-rejected" class="pilcrow"></a>
Zero-length array keys are rejected
  </h4>
</div>
<p>Though this was already the case because <code>_checkKey</code> stringified its input before checking the length, that behavior has been replaced with an explicit <code>Array.isArray()</code> check and a new error message.</p>
<div class="pilwrap" id="no-longer-assumes-support-of-boolean-and-nan-keys">
  <h4>
    <a href="#no-longer-assumes-support-of-boolean-and-nan-keys" name="no-longer-assumes-support-of-boolean-and-nan-keys" class="pilcrow"></a>
No longer assumes support of boolean and <code>NaN</code> keys
  </h4>
</div>
<p>A test that asserted boolean and <code>NaN</code> keys were valid has been removed.</p>
<div class="pilwrap" id="browser-support">
  <h4>
    <a href="#browser-support" name="browser-support" class="pilcrow"></a>
Browser support
  </h4>
</div>
<p>IE10 has been dropped.</p>
<div class="pilwrap" id="changes-to-private-api">
  <h3>
    <a href="#changes-to-private-api" name="changes-to-private-api" class="pilcrow"></a>
Changes to private API
  </h3>
</div>
<div class="pilwrap" id="location-was-removed">
  <h4>
    <a href="#location-was-removed" name="location-was-removed" class="pilcrow"></a>
<code>location</code> was removed
  </h4>
</div>
<p><code>AbstractLevelDOWN</code> is no longer associated with a <code>location</code>. It's up to the implementation to handle it if it's required.</p>
<p>If your implementation has a <code>location</code> and you previously did:</p>
<pre><code class="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">YourDOWN</span> (<span class="hljs-params">location</span>) </span>{
  AbstractLevelDOWN.call(<span class="hljs-keyword">this</span>, location)
}
</code></pre>
<p>You must now do:</p>
<pre><code class="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">YourDOWN</span> (<span class="hljs-params">location</span>) </span>{
  <span class="hljs-keyword">this</span>.location = location
  AbstractLevelDOWN.call(<span class="hljs-keyword">this</span>)
}
</code></pre>
<p>Be sure to include appropriate type checks. If you relied on the default <code>AbstractLevelDOWN</code> behavior that would be:</p>
<pre><code class="js"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> location !== <span class="hljs-string">'string'</span>) {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'constructor requires a location string argument'</span>)
}
</code></pre>
<div class="pilwrap" id="abstract-test-suite-has-moved-to-a-single-entry-point">
  <h4>
    <a href="#abstract-test-suite-has-moved-to-a-single-entry-point" name="abstract-test-suite-has-moved-to-a-single-entry-point" class="pilcrow"></a>
Abstract test suite has moved to a single entry point
  </h4>
</div>
<p>Instead of including test files individually, you can and should include the test suite with one <code>require()</code> statement. If you previously did:</p>
<pre><code class="js"><span class="hljs-keyword">const</span> test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tape'</span>)
<span class="hljs-keyword">const</span> testCommon = <span class="hljs-built_in">require</span>(<span class="hljs-string">'abstract-leveldown/testCommon'</span>)
<span class="hljs-keyword">const</span> YourDOWN = <span class="hljs-built_in">require</span>(<span class="hljs-string">'.'</span>)

<span class="hljs-built_in">require</span>(<span class="hljs-string">'abstract-leveldown/abstract/get-test'</span>).all(YourDOWN, test, testCommon)
<span class="hljs-built_in">require</span>(<span class="hljs-string">'abstract-leveldown/abstract/put-test'</span>).all(YourDOWN, test, testCommon)

<span class="hljs-comment">// etc</span>
</code></pre>
<p>You must now do:</p>
<pre><code class="js"><span class="hljs-keyword">const</span> test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tape'</span>)
<span class="hljs-keyword">const</span> suite = <span class="hljs-built_in">require</span>(<span class="hljs-string">'abstract-leveldown/test'</span>)
<span class="hljs-keyword">const</span> YourDOWN = <span class="hljs-built_in">require</span>(<span class="hljs-string">'.'</span>)

suite({
  <span class="hljs-attr">test</span>: test,
  <span class="hljs-attr">factory</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> YourDOWN()
  }
})
</code></pre>
<p>The input to the test suite is a new form of <code>testCommon</code>. Should you need to reuse <code>testCommon</code> for your own (additional) tests, use the included utility to create a <code>testCommon</code> with defaults:</p>
<pre><code class="js"><span class="hljs-keyword">const</span> test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tape'</span>)
<span class="hljs-keyword">const</span> suite = <span class="hljs-built_in">require</span>(<span class="hljs-string">'abstract-leveldown/test'</span>)
<span class="hljs-keyword">const</span> YourDOWN = <span class="hljs-built_in">require</span>(<span class="hljs-string">'.'</span>)

<span class="hljs-keyword">const</span> testCommon = suite.common({
  <span class="hljs-attr">test</span>: test,
  <span class="hljs-attr">factory</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> YourDOWN()
  }
})

suite(testCommon)
</code></pre>
<p>As part of removing <code>location</code>, the abstract tests no longer use <code>testCommon.location()</code>. Instead an implementation <em>must</em> implement <code>factory()</code> which <em>must</em> return a unique and isolated database instance. This allows implementations to pass options to their constructor.</p>
<p>The <code>testCommon.cleanup</code> method has been removed. Because <code>factory()</code> returns a unique database instance, cleanup should no longer be necessary. The <code>testCommon.lastLocation</code> method has also been removed as there is no remaining use of it in abstract tests.</p>
<p>Previously, implementations using the default <code>testCommon</code> had to include <code>rimraf</code> in their <code>devDependencies</code> and browser-based implementations had to exclude <code>rimraf</code> from browserify builds. This is no longer the case.</p>
<p>If your implementation is disk-based we recommend using <a href="https://github.com/sindresorhus/tempy"><code>tempy</code></a> (or similar) to create unique temporary directories. Together with <code>factory()</code> your setup could now look something like:</p>
<pre><code class="js"><span class="hljs-keyword">const</span> test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tape'</span>)
<span class="hljs-keyword">const</span> tempy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tempy'</span>)
<span class="hljs-keyword">const</span> suite = <span class="hljs-built_in">require</span>(<span class="hljs-string">'abstract-leveldown/test'</span>)
<span class="hljs-keyword">const</span> YourDOWN = <span class="hljs-built_in">require</span>(<span class="hljs-string">'.'</span>)

suite({
  <span class="hljs-attr">test</span>: test,
  <span class="hljs-attr">factory</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> YourDOWN(tempy.directory())
  }
})
</code></pre>
<div class="pilwrap" id="the-collectentries-utility-has-moved">
  <h4>
    <a href="#the-collectentries-utility-has-moved" name="the-collectentries-utility-has-moved" class="pilcrow"></a>
The <code>collectEntries</code> utility has moved
  </h4>
</div>
<p>The <code>testCommon.collectEntries</code> method has moved to the npm package  <code>level-concat-iterator</code>. If your (additional) tests depend on <code>collectEntries</code> and you previously did:</p>
<pre><code class="js">testCommon.collectEntries(iterator, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, entries</span>) </span>{})
</code></pre>
<p>You must now do:</p>
<pre><code class="js"><span class="hljs-keyword">const</span> concat = <span class="hljs-built_in">require</span>(<span class="hljs-string">'level-concat-iterator'</span>)
concat(iterator, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, entries</span>) </span>{})
</code></pre>
<div class="pilwrap" id="setup-and-teardown-became-noops">
  <h4>
    <a href="#setup-and-teardown-became-noops" name="setup-and-teardown-became-noops" class="pilcrow"></a>
Setup and teardown became noops
  </h4>
</div>
<p>Because cleanup is no longer necessary, the <code>testCommon.setUp</code> and <code>testCommon.tearDown</code> methods are now noops by default. If you do need to perform (a)synchronous work before or after each test, <code>setUp</code> and <code>tearDown</code> can be overridden:</p>
<pre><code class="js">suite({
  <span class="hljs-comment">// ..</span>
  <span class="hljs-attr">setUp</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
    t.end()
  },
  <span class="hljs-attr">tearDown</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
    t.end()
  }
})
</code></pre>
<div class="pilwrap" id="optional-tests-have-been-separated">
  <h4>
    <a href="#optional-tests-have-been-separated" name="optional-tests-have-been-separated" class="pilcrow"></a>
Optional tests have been separated
  </h4>
</div>
<p>If your implementation does not support snapshots or other optional features, the relevant tests may be skipped. For example:</p>
<pre><code class="js">suite({
  <span class="hljs-comment">// ..</span>
  <span class="hljs-attr">snapshots</span>: <span class="hljs-literal">false</span>
})
</code></pre>
<p>Please see the <a href="README.md.html">README</a> for a list of options. Note that some of these have replaced <code>process.browser</code> checks.</p>
<div class="pilwrap" id="iterator-must-have-a-db-reference">
  <h4>
    <a href="#iterator-must-have-a-db-reference" name="iterator-must-have-a-db-reference" class="pilcrow"></a>
Iterator must have a <code>db</code> reference
  </h4>
</div>
<p>The <code>db</code> argument of the <code>AbstractIterator</code> constructor became mandatory, as well as a public <code>db</code> property on the instance. Its existence is not new; the test suite now asserts that your implementation also has it.</p>
<div class="pilwrap" id="seeking-became-part-of-official-api">
  <h4>
    <a href="#seeking-became-part-of-official-api" name="seeking-became-part-of-official-api" class="pilcrow"></a>
Seeking became part of official API
  </h4>
</div>
<p>If your implementation previously defined the public <code>iterator.seek(target)</code>, it must now define the private <code>iterator._seek(target)</code>. The new public API is equal to the reference implementation of <code>leveldown</code> except for two differences:</p>
<ul>
<li>The <code>target</code> argument is not type checked, this is up to the implementation.</li>
<li>The <code>target</code> argument is passed through <code>db._serializeKey</code>.</li>
</ul>
<p>Please see the <a href="README.md.html">README</a> for details.</p>
<div class="pilwrap" id="chained-batch-has-been-refactored">
  <h4>
    <a href="#chained-batch-has-been-refactored" name="chained-batch-has-been-refactored" class="pilcrow"></a>
Chained batch has been refactored
  </h4>
</div>
<ul>
<li>The default <code>_clear</code> method is no longer a noop; instead it clears the operations queued by <code>_put</code> and/or <code>_del</code></li>
<li>The <code>_write</code> method now takes an <code>options</code> object as its first argument</li>
<li>The <code>db</code> argument of the <code>AbstractChainedBatch</code> constructor became mandatory, as well as a public <code>db</code> property on the instance, which was previously named <code>_db</code>.</li>
</ul>
<div class="pilwrap" id="default-_serializekey-and-_serializevalue-became-identity-functions">
  <h4>
    <a href="#default-_serializekey-and-_serializevalue-became-identity-functions" name="default-_serializekey-and-_serializevalue-became-identity-functions" class="pilcrow"></a>
Default <code>_serializeKey</code> and <code>_serializeValue</code> became identity functions
  </h4>
</div>
<p>They return whatever is given. Previously they were opinionated and mostly geared towards string- and Buffer-based storages. Implementations that didn't already define their own serialization should now do so, according to the types that they support. Please refer to the <a href="README.md.html">README</a> for recommended behavior.</p>
<div class="pilwrap" id="v5">
  <h2>
    <a href="#v5" name="v5" class="pilcrow"></a>
v5
  </h2>
</div>
<p>Dropped support for node 4. No other breaking changes.</p>
<div class="pilwrap" id="v4">
  <h2>
    <a href="#v4" name="v4" class="pilcrow"></a>
v4
  </h2>
</div>
<div class="pilwrap" id="default-testcommon-parameter">
  <h4>
    <a href="#default-testcommon-parameter" name="default-testcommon-parameter" class="pilcrow"></a>
default <code>testCommon</code> parameter
  </h4>
</div>
<p>The <code>testCommon</code> parameter will now default to <code>abstract-leveldown/testCommon.js</code>. You can omit this parameter, unless your implementation needs a custom version.</p>
<p>If your code today looks something like:</p>
<pre><code class="js"><span class="hljs-keyword">const</span> test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tape'</span>)
<span class="hljs-keyword">const</span> testCommon = <span class="hljs-built_in">require</span>(<span class="hljs-string">'abstract-leveldown/testCommon'</span>)
<span class="hljs-keyword">const</span> leveldown = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./your-leveldown'</span>)
<span class="hljs-keyword">const</span> abstract = <span class="hljs-built_in">require</span>(<span class="hljs-string">'abstract-leveldown/abstract/get-test'</span>)

abstract.all(leveldown, test, testCommon)
</code></pre>
<p>You can simplify it to:</p>
<pre><code class="js"><span class="hljs-keyword">const</span> test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tape'</span>)
<span class="hljs-keyword">const</span> leveldown = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./your-leveldown'</span>)
<span class="hljs-keyword">const</span> abstract = <span class="hljs-built_in">require</span>(<span class="hljs-string">'abstract-leveldown/abstract/get-test'</span>)

abstract.all(leveldown, test)
</code></pre>
<div class="pilwrap" id="testbuffer-parameter-removed">
  <h4>
    <a href="#testbuffer-parameter-removed" name="testbuffer-parameter-removed" class="pilcrow"></a>
<code>testBuffer</code> parameter removed
  </h4>
</div>
<p>The <code>abstract/put-get-del-test.js</code> previously took a custom <code>testBuffer</code> parameter. After an <a href="https://github.com/Level/abstract-leveldown/pull/175#issuecomment-353867144">analysis</a> of various implementations we came to the conclusion that the parameter has no use.</p>
<p>If your implementation is using this abstract test, change from:</p>
<pre><code class="js"><span class="hljs-keyword">const</span> test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tape'</span>)
<span class="hljs-keyword">const</span> testCommon = <span class="hljs-built_in">require</span>(<span class="hljs-string">'abstract-leveldown/testCommon'</span>)
<span class="hljs-keyword">const</span> leveldown = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./your-leveldown'</span>)
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)
<span class="hljs-keyword">const</span> testBuffer = fs.readFileSync(path.join(__dirname, <span class="hljs-string">'data/testdata.bin'</span>))
<span class="hljs-keyword">const</span> abstract = <span class="hljs-built_in">require</span>(<span class="hljs-string">'abstract-leveldown/abstract/put-get-del-test'</span>)

abstract.all(leveldown, test, testBuffer, testCommon)
</code></pre>
<p>to:</p>
<pre><code class="js"><span class="hljs-keyword">const</span> test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tape'</span>)
<span class="hljs-keyword">const</span> testCommon = <span class="hljs-built_in">require</span>(<span class="hljs-string">'abstract-leveldown/testCommon'</span>)
<span class="hljs-keyword">const</span> leveldown = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./your-leveldown'</span>)
<span class="hljs-keyword">const</span> abstract = <span class="hljs-built_in">require</span>(<span class="hljs-string">'abstract-leveldown/abstract/put-get-del-test'</span>)

abstract.all(leveldown, test, testCommon)
</code></pre>
<p>or if <code>testCommon</code> is also redundant, to:</p>
<pre><code class="js"><span class="hljs-keyword">const</span> test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tape'</span>)
<span class="hljs-keyword">const</span> leveldown = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./your-leveldown'</span>)
<span class="hljs-keyword">const</span> abstract = <span class="hljs-built_in">require</span>(<span class="hljs-string">'abstract-leveldown/abstract/put-get-del-test'</span>)

abstract.all(leveldown, test)
</code></pre>
<div class="pilwrap" id=".approximatesize-method-removed">
  <h4>
    <a href="#.approximatesize-method-removed" name=".approximatesize-method-removed" class="pilcrow"></a>
<code>.approximateSize</code> method removed
  </h4>
</div>
<p>The <code>.approximateSize</code> method has been removed from the public API. It is heavily related to <code>LevelDB</code> and more often than not, other stores lack the native primitives to implement this. If you did implement the internal <code>_approximateSize</code> method, that is now dead code. To preserve the method in your public API, rename it to <code>approximateSize</code> and also take care of the initialization code. Look to <code>leveldown</code> for inspiration.</p>
<p>Also, the corresponding abstract tests have been removed, so your implementation can no longer require <code>abstract/approximate-size-test</code>.</p>
<div class="pilwrap" id="._isbuffer-method-removed">
  <h4>
    <a href="#._isbuffer-method-removed" name="._isbuffer-method-removed" class="pilcrow"></a>
<code>._isBuffer</code> method removed
  </h4>
</div>
<p>Because <code>Buffer</code> is available in all environments nowadays, there is no need for alternatives like typed arrays. It is preferred to use <code>Buffer</code> and <code>Buffer.isBuffer()</code> directly.</p>
<div class="pilwrap" id="isleveldown-function-removed">
  <h4>
    <a href="#isleveldown-function-removed" name="isleveldown-function-removed" class="pilcrow"></a>
<code>isLevelDOWN</code> function removed
  </h4>
</div>
<p>This was a legacy function.</p>
<div class="pilwrap" id="ranges-test.js-renamed">
  <h4>
    <a href="#ranges-test.js-renamed" name="ranges-test.js-renamed" class="pilcrow"></a>
<code>ranges-test.js</code> renamed
  </h4>
</div>
<p>We have refactored a lot of the tests. Specifically the iterator tests were split in two and in that process we renamed <code>ranges-test.js</code> to <code>iterator-range-test.js</code>.</p>
<p>If your implementation is using these tests then change from:</p>
<pre><code class="js"><span class="hljs-keyword">const</span> abstract = <span class="hljs-built_in">require</span>(<span class="hljs-string">'abstract-leveldown/abstract/ranges-test'</span>)
</code></pre>
<p>to:</p>
<pre><code class="js"><span class="hljs-keyword">const</span> abstract = <span class="hljs-built_in">require</span>(<span class="hljs-string">'abstract-leveldown/abstract/iterator-range-test'</span>)
</code></pre>
<div class="pilwrap" id="v3">
  <h2>
    <a href="#v3" name="v3" class="pilcrow"></a>
v3
  </h2>
</div>
<p>No changes to the API. New major version because support for node 0.12 was dropped.</p>
</div>
  </div>
</body>
</html>
